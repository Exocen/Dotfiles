FROM debian:latest

ENV DEBIAN_FRONTEND="noninteractive"
RUN apt-get -y update
RUN apt-get -y upgrade
RUN apt-get install -y --no-install-recommends python3 python3-pip python3-venv git ffmpeg iputils-ping
RUN python3 -m venv /root/ydl_env
RUN /root/ydl_env/bin/pip3 install mutagen
RUN /root/ydl_env/bin/pip3 install "git+https://github.com/ytdl-org/youtube-dl.git"

WORKDIR /root/
COPY docker-entrypoint.sh healthcheck.sh ydl /root/
RUN /bin/bash -c "chmod +x *.sh"
HEALTHCHECK CMD /root/healthcheck.sh
ENTRYPOINT ["/root/docker-entrypoint.sh"]

FROM debian:latest
ARG DOMAIN

VOLUME /etc/letsencrypt/
EXPOSE 80/TCP 443/TCP

ENV DEBIAN_FRONTEND="noninteractive"
RUN apt-get -y update
RUN apt-get -y upgrade
RUN apt-get install -y --no-install-recommends nginx certbot python3-certbot-nginx locales
RUN locale-gen

WORKDIR /root/
COPY docker-entrypoint.sh nginx.conf healthcheck.sh /root/
RUN find . -type f -print0 | xargs -0 sed -i 's/\[DOMAIN\]/'$DOMAIN'/g'
RUN /bin/bash -c "chmod +x *.sh"

HEALTHCHECK --interval=5m --timeout=30s CMD ./healthcheck.sh

ENTRYPOINT ["/root/docker-entrypoint.sh"]

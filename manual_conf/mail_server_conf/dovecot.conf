# Enable installed protocols
!include_try /usr/share/dovecot/protocols.d/*.protocol
protocols = imap lmtp
# pop3

postmaster_address = postmaster at [DOMAIN]
disable_plaintext_auth = yes
auth_mechanisms = plain login

mail_location = maildir:/var/mail/vhosts/%d/%n/
namespace inbox {
  inbox = yes
}

mail_privileged_group = mail
service imap-login {
  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

service lmtp {
  unix_listener /var/spool/postfix/private/dovecot-lmtp {
    mode = 0600
    user = postfix
    group = postfix
  }
}

service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }

  unix_listener auth-userdb {
    mode = 0600
    user = vmail
  }
  user = dovecot
}

service auth-worker {
  user = vmail
}

passdb {
  driver = sql
  args = /etc/dovecot/dovecot-sql.conf.ext
}

userdb {
  driver = static
  args = uid=vmail gid=vmail home=/var/mail/vhosts/%d/%n
}

#SSL
ssl = required
ssl_cert = </etc/letsencrypt/live/[DOMAIN]/fullchain.pem
ssl_key = </etc/letsencrypt/live/[DOMAIN]/privkey.pem
ssl_client_ca_dir = /etc/ssl/certs


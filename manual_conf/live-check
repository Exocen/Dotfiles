#!/bin/bash

#TODO Description
#TODO service emitter + receiver

TIMESTAMP_FILEPATH=$HOME/live-check-timestamp
TIME_DELAY="4 hour"

function usage(){
    echo "Usage: live-check save/check"
    exit 1
}

function save(){
    date -d "$TIME_DELAY" +%s > $TIMESTAMP_FILEPATH
    exit 0
}

function check(){
    if [ -f "$TIMESTAMP_FILEPATH" ]; then
        if [ `date +%s` -ge `cat $TIMESTAMP_FILEPATH` ]; then
            echo "Live-check Expired"
            rm $TIMESTAMP_FILEPATH
            echo -e "Subject:Live-Check Expired\n`date`" | sendmail $USER@`hostname`
        fi
    fi
    exit 0
}

if [ $# -eq 1 ]; then
    if [ $1 = "save" ]; then
        save
    fi
    if [ $1 = "check" ]; then
        check
    fi
fi
usage
